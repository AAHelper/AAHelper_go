
<script type="text/javascript">
	var map;
	function initialize() {
		var bounds = new google.maps.LatLngBounds();
		var infowindow = new google.maps.InfoWindow()
		var mapDiv = document.getElementById('map');
		var map = new google.maps.Map(mapDiv, {
			zoom: 4,
		});
        {% for id, meeting in meeting_js.Locations %}
            {% comment %} {% with meeting.Location.location as location %} {% endcomment %}
                {% if meeting.Lat %}
                    var point = new google.maps.LatLng({{meeting.Lat}}, {{meeting.Lon}});
                    var marker = new google.maps.Marker({
                        position: point,
                        map: map,
                        title: '{{ meeting.meeting.Name }}',
                        {% comment %} label: '{{ meeting.meeting.Name }}' {% endcomment %}
                    });
                    marker['infowindow']  = new google.maps.InfoWindow({
                            content: '{{ meeting.PopUpText|safe }}<p><a href="/locations/{{meeting.Meeting.LocationID.Value}}">Other Meetings at this location.</a></p>',
                    });
                    google.maps.event.addListener(marker, 'click', function() {
                        //window.location.href = this.url;
                        this['infowindow'].open(map, this);
                    });

                    bounds.extend(marker.position);

                {% endif %}
            {% comment %} {% endwith %} {% endcomment %}
        {% endfor %}


		map.fitBounds(bounds);
        google.maps.event.addListener(map, "click", function(event) {
            infowindow.close();
        });
	}
</script>
<script async defer src="https://maps.google.com/maps/api/js?key=AIzaSyCRB2jA_b4InjlQtslR5g5NO9n8dUTdJ0Q&callback=initialize"></script>


	{% comment %} <div class="user_item">
		<!-- Let's indicate a user's good karma -->
		<h2 {% if (user.karma >= 40) || (user.karma > calc_avg_karma(userlist)+5) %}
			class="karma-good"{% endif %}>
			
			<!-- This will call user.String() automatically if available: -->
			{{ user }}
		</h2>

		<!-- Will print a human-readable time duration like "3 weeks ago" -->
		<p>This user registered {{ user.register_date|naturaltime }}.</p>
		
		<!-- Let's allow the users to write down their biography using markdown;
		     we will only show the first 15 words as a preview -->
		<p>The user's biography:</p>
		<p>{{ user.biography|markdown|truncatewords_html:15 }}
			<a href="/user/{{ user.id }}/">read more</a></p>
		
		{% if is_admin %}<p>This user is an admin!</p>{% endif %}
	</div> {% endcomment %}
